(this.webpackJsonpjeopardy_frontend=this.webpackJsonpjeopardy_frontend||[]).push([[0],{110:function(e,t,n){},240:function(e,t,n){},242:function(e,t,n){},243:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n(1),a=n.n(s),c=n(20),i=n.n(c),o=(n(110),n(8)),u=n(7),l=n(3),j=n(6),d=n(47),m=function(e){var t=e.label,n=Object(d.a)(e,["label"]),s=Object(o.d)(n),a=Object(j.a)(s,2),c=a[0],i=a[1];return Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsxs)("label",{htmlFor:n.name,children:[" ",t," "]}),Object(r.jsx)("input",Object(l.a)(Object(l.a)({className:"text-input"},c),n)),Object(r.jsxs)("div",{className:"error",style:{visibility:i.touched&&i.error?"visible":"hidden"},children:[i.error||"no error"," "]})]})},b=function(e){var t=Object(o.d)(e),n=Object(j.a)(t,2)[1];return Object(r.jsx)("div",{className:"form-group",children:Object(r.jsxs)("div",{className:"error",style:{visibility:n.error?"visible":"hidden"},children:[n.error||"no error"," "]})})},h=n(9),O=n(14),f=n(4),x=n(5),_=n(12),p=n.n(_),v="http://127.0.0.1:8000/static";p.a.defaults.baseURL="http://127.0.0.1:8000/api",p.a.interceptors.request.use((function(e){if("/sessions/"!==e.url){var t=localStorage.getItem("access_token");e.headers.Authorization="Bearer ".concat(t)}return e})),p.a.interceptors.response.use((function(e){return e}),(function(e){if(401!==e.response.status||"/sessions/"===e.config.url)return console.log(e),Promise.reject(e);var t=localStorage.getItem("refresh_token");if(t)return p.a.post("/sessions/new_token/",{refresh:t}).then((function(e){localStorage.setItem("access_token",e.data.access)})),p.a.request(e.config);console.log(e.response)}));var g=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"register",value:function(e){return p.a.post("/users/",{username:e.username,nickname:e.nickname,password:e.password}).then((function(e){return localStorage.setItem("access_token",e.data.access),localStorage.setItem("refresh_token",e.data.refresh),e.status})).catch((function(e){return e.response.status}))}},{key:"login",value:function(e){return p.a.post("/sessions/",{username:e.username,password:e.password}).then((function(e){return localStorage.setItem("access_token",e.data.access),localStorage.setItem("refresh_token",e.data.refresh),e.status})).catch((function(e){return e.response.status}))}}]),e}(),y=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"getDescriptions",value:function(){return p.a.get("/games/")}}]),e}(),w=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"getDescriptions",value:function(){return p.a.get("/game_sessions/")}}]),e}(),N=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"post",value:function(e,t,n){var r={};r.name=e;var s=n.filter((function(e){return"final"===e.theme}))[0];r.final_round={text:s.text,answer:s.answer,value:s.value},r.rounds=[];for(var a=function(e){var s,a={themes:[]},c=Object(O.a)(t[e]);try{var i=function(){var t=s.value,r={};r.name=t.name,r.questions=n.filter((function(t){return t.round===e&&t.theme===r.name})).sort((function(e,t){return e.value-t.value}));var c,i=Object(O.a)(r.questions);try{for(i.s();!(c=i.n()).done;){var o=c.value;delete o.theme,delete o.round}}catch(u){i.e(u)}finally{i.f()}a.themes.push(r)};for(c.s();!(s=c.n()).done;)i()}catch(o){c.e(o)}finally{c.f()}r.rounds.push(a)},c=1;c<t.length;c++)a(c);return console.log(r),p.a.post("/games/",r).catch((function(e){if(409===e.response.status)return Promise.reject(new Error("\u0418\u0433\u0440\u0430 \u0441 \u0442\u0430\u043a\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442"))}))}}]),e}(),S=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"get",value:function(e){var t="/users/".concat(e,"/");return p.a.get(t)}},{key:"save",value:function(e,t,n){var r="/users/".concat(e,"/"),s={};return t&&t.length>0&&(s.nickname=t),n&&n.length>0&&(s.password=n),p.a.patch(r,s)}}]),e}(),q=function(){function e(){Object(f.a)(this,e)}return Object(x.a)(e,[{key:"create",value:function(e,t){return console.log("create"),p.a.post("/game_sessions/",{game_name:e,max_players:t})}},{key:"join",value:function(e){var t="game_sessions/chosen/".concat(e,"/");return p.a.post(t)}},{key:"leave",value:function(e){var t="game_sessions/exited/".concat(e,"/");p.a.delete(t)}},{key:"choose_question",value:function(e,t,n){var r="game_sessions/".concat(e,"/question/");p.a.post(r,{theme_order:t,question_order:n}).catch((function(e){return console.log(e)}))}},{key:"submit_answer",value:function(e,t){var n="game_sessions/".concat(e,"/answer/");p.a.post(n,{answer:t})}},{key:"get_host_image_url",value:function(e){var t=v+"/img/kuleshov/"+e+".jpg";return console.log(t),t}},{key:"get_avatar_url",value:function(){var e=v+"/img/avatar.png";return console.log(e),e}}]),e}(),k=Object(s.createContext)({}),E=new g;function I(){return Object(s.useContext)(k)}function T(e){var t=e.children,n=function(){function e(e){localStorage.setItem("username",e)}return{register:function(t){return E.register(t).then((function(n){if(!(n<400)){var r;switch(n){case 409:r="\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442";break;case 401:r="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435";break;default:r="\u041e\u0448\u0438\u0431\u043a\u0430"}return Promise.reject(new Error(r))}e(t.username)}))},login:function(t){return E.login(t).then((function(n){if(!(n<400)){var r;switch(n){case 401:r="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435";break;default:r="\u041e\u0448\u0438\u0431\u043a\u0430"}return Promise.reject(new Error(r))}e(t.username)}))},isAuthenticated:function(){return null!==localStorage.getItem("access_token")},getUsername:function(){return localStorage.getItem("username")}}}();return Object(r.jsx)(k.Provider,{value:n,children:t})}function D(e){var t=e.children,n=Object(d.a)(e,["children"]),s=I();return Object(r.jsx)(h.b,Object(l.a)(Object(l.a)({},n),{},{render:function(e){var n=e.location;return s.isAuthenticated()?t:Object(r.jsx)(h.a,{to:{pathname:"/login",state:{from:n}}})}}))}var A=n(13),R=function(){var e=I(),t=Object(h.g)();return document.title="\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",Object(r.jsx)("div",{className:"form",children:Object(r.jsx)(o.c,{initialValues:{username:"",nickname:"",password:""},validationSchema:u.b({username:u.c().min(2,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 2 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").max(25,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 25 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435"),nickname:u.c().min(2,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 2 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").max(25,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 25 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),password:u.c().min(6,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 6 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").max(128,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 128 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435")}),onSubmit:function(n,r){var s=r.setSubmitting,a=r.setErrors;e.register(n).then((function(){console.log("\u0437\u0430\u0440\u0435\u0433\u0430\u043d"),s(!1),t.push("/games")})).catch((function(e){a({submitError:e.message})}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(r.jsx)(m,{label:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"username",type:"text"}),Object(r.jsx)(m,{label:"\u041d\u0438\u043a",name:"nickname",type:"text",placeholder:"\u041d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e"}),Object(r.jsx)(m,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password"}),Object(r.jsx)(b,{name:"submitError"}),Object(r.jsx)(A.b,{to:"/login",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"}),Object(r.jsx)("button",{type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})})})},U=function(){var e=I(),t=Object(h.g)();return document.title="\u0412\u0445\u043e\u0434",Object(r.jsx)("div",{className:"form",children:Object(r.jsx)(o.c,{initialValues:{username:"",password:""},validationSchema:u.b({username:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435"),password:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435")}),onSubmit:function(n,r){var s=r.setSubmitting,a=r.setErrors;e.login(n).then((function(){s(!1),t.push("/games")})).catch((function(e){a({submitError:e.message})}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u0412\u0445\u043e\u0434"}),Object(r.jsx)(m,{label:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"username",type:"text"}),Object(r.jsx)(m,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password"}),Object(r.jsx)(b,{name:"submitError"}),Object(r.jsx)(A.b,{to:"/register",children:"\u0415\u0449\u0435 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"}),Object(r.jsx)("button",{type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"})]})})})},C=(n(94),n(30)),G=n.n(C),F=new y,L=new q,P=function(e){return Object(r.jsx)(o.c,{initialValues:{max_players:"2"},validationSchema:u.b({max_players:u.a().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").min(2,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 2 \u0438\u0433\u0440\u043e\u043a\u043e\u0432").max(10,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 10 \u0438\u0433\u0440\u043e\u043a\u043e\u0432")}),onSubmit:function(t,n){var r=n.setSubmitting;L.create(e.gameName,t.max_players).then((function(t){r(!1),e.history.push("/game",t.data)}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430"}),Object(r.jsx)(m,{label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0438\u0433\u0440\u043e\u043a\u043e\u0432",name:"max_players",type:"text"}),Object(r.jsx)("button",{type:"submit",children:"\u041d\u0430\u0447\u0430\u0442\u044c \u0438\u0433\u0440\u0443"})]})})},Q=function(e){var t=e.descr;return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:t.author}),Object(r.jsx)("td",{children:t.name}),Object(r.jsx)("td",{children:t.rounds_count}),Object(r.jsx)("td",{children:Object(r.jsx)("button",{onClick:function(){return e.createGameSession(t.name)},children:"\u0418\u0433\u0440\u0430\u0442\u044c"})})]})},V=function(){var e=Object(s.useState)([]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(!1),i=Object(j.a)(c,2),o=i[0],u=i[1],l=Object(s.useState)(0),d=Object(j.a)(l,2),m=d[0],b=d[1],O=Object(h.g)();return Object(s.useEffect)((function(){document.title="\u0418\u0433\u0440\u044b",F.getDescriptions().then((function(e){a(e.data)}))}),[]),Object(r.jsxs)("div",{className:"games",children:[Object(r.jsx)("header",{children:"\u0418\u0433\u0440\u044b"}),Object(r.jsxs)("table",{className:"list games-table",children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"\u0410\u0432\u0442\u043e\u0440"}),Object(r.jsx)("th",{children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}),Object(r.jsx)("th",{children:"\u0420\u0430\u0443\u043d\u0434\u044b"})]})},"games-table-head"),Object(r.jsx)("tbody",{children:n.map((function(e){return Object(r.jsx)(Q,{descr:e,createGameSession:function(e){b(e),u(!0)}},e.name)}))})]}),Object(r.jsx)("button",{onClick:function(){return O.push("/games/new")},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0438\u0433\u0440\u0443"}),Object(r.jsx)(G.a,{className:"modal form create-game-session",overlayClassName:"overlay",isOpen:o,onRequestClose:function(){return u(!1)},ariaHideApp:!1,children:Object(r.jsx)(P,{gameName:m,history:O})})]})};n(240);var H=function(){var e=I().getUsername();return Object(r.jsxs)("header",{className:"nav",children:[Object(r.jsxs)("nav",{children:[Object(r.jsx)(A.c,{to:"/games",activeClassName:"active",children:"\u0418\u0433\u0440\u044b"}),Object(r.jsx)(A.c,{to:"/lobby",activeClassName:"active",children:"\u041b\u043e\u0431\u0431\u0438"})]}),Object(r.jsx)(A.b,{to:"/user",children:e})]})},W=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(f.a)(this,e),this.url=e.createUrl(t,n),this.listener=null,this.ws=new WebSocket(this.url)}return Object(x.a)(e,[{key:"setListener",value:function(e){var t=this;this.listener=e,this.ws.onmessage=function(e){var n=JSON.parse(e.data);console.log("ws",n),t.listener([n.event,n.data])}}},{key:"close",value:function(){console.log("ws close"),this.ws.close()}}],[{key:"createUrl",value:function(e,t){switch(e){case"lobby":return"ws://127.0.0.1:8000/ws/lobby/";case"game":return"ws://127.0.0.1:8000/ws/game_sessions/".concat(t,"/");default:throw new Error("\u043d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439")}}}]),e}(),M=new q,J=function(e){var t=e.descr;return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:t.creator}),Object(r.jsx)("td",{children:t.game_name}),Object(r.jsxs)("td",{children:[t.current_players,"/",t.max_players]}),Object(r.jsx)("td",{children:Object(r.jsx)("button",{onClick:function(){M.join(t.id).then((function(t){return e.history.push("/game",t.data)}))},children:"\u0418\u0433\u0440\u0430\u0442\u044c"})})]})};function z(e,t){var n=Object(j.a)(t,2),r=n[0],s=n[1];switch(r){case"init":return s;case"game_session_created":return e.concat(s);case"game_session_deleted":var a=e.findIndex((function(e){return e.id===s.game_session_id}));return e.slice(0,a-1).concat(e.slice(a+1));case"player_joined":var c=e.findIndex((function(e){return e.id===s.game_session_id}));return e.slice(0,c-1).concat(Object(l.a)(Object(l.a)({},e[c]),{},{current_players:e[c].current_players+1}),e.slice(c+1));case"player_left":var i=e.findIndex((function(e){return e.id===s.game_session_id}));return e.slice(0,i-1).concat(Object(l.a)(Object(l.a)({},e[i]),{},{current_players:e[i].current_players-1}),e.slice(i+1));default:throw new Error("\u043d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f")}}var B=function(){var e=Object(s.useReducer)(z,[]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(h.g)();return Object(s.useEffect)((function(){document.title="\u041b\u043e\u0431\u0431\u0438";var e=new W("lobby");return e.setListener(a),(new w).getDescriptions().then((function(e){a(["init",e.data])})),function(){return e.close()}}),[]),Object(r.jsxs)("div",{className:"lobby",children:[Object(r.jsx)("header",{children:"\u041b\u043e\u0431\u0431\u0438"}),Object(r.jsxs)("table",{className:"list lobby-table",children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c"}),Object(r.jsx)("th",{children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}),Object(r.jsx)("th",{children:"\u0418\u0433\u0440\u043e\u043a\u0438"})]})},"lobby-table-head"),Object(r.jsx)("tbody",{children:n.length>0&&n.map((function(e){return Object(r.jsx)(J,{descr:e,history:c},e.creator)}))})]})]})},K=(n(98),Object.freeze({WAITING:0,ROUND_STARTED:1,CHOOSING_QUESTION:2,ANSWERING:3,TIMEOUT:4,ROUND_ENDED:5,FINAL_ROUND_STARTED:6,FINAL_ROUND:7,END_GAME:8}));function X(e){return["\u041d\u0443\u043b\u0435\u0432\u043e\u0439","\u041f\u0435\u0440\u0432\u044b\u0439","\u0412\u0442\u043e\u0440\u043e\u0439","\u0422\u0440\u0435\u0442\u0438\u0439","\u0427\u0435\u0442\u0432\u0435\u0440\u0442\u044b\u0439","\u041f\u044f\u0442\u044b\u0439","\u0428\u0435\u0441\u0442\u043e\u0439","\u0421\u0435\u0434\u044c\u043c\u043e\u0439","\u0412\u043e\u0441\u044c\u043c\u043e\u0439","\u0414\u0435\u0432\u044f\u0442\u044b\u0439"][e]}var Y=new N,Z=function(e){return Object(r.jsx)("div",{className:"form",children:Object(r.jsx)(o.c,{initialValues:{name:"",rounds_count:"3",questions_count:"5"},validationSchema:u.b({name:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435"),rounds_count:u.a().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").min(2,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 2 \u0440\u0430\u0443\u043d\u0434\u043e\u0432").max(10,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 10 \u0440\u0430\u0443\u043d\u0434\u043e\u0432").typeError("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e").integer("\u0422\u0430\u043a \u0442\u043e\u0436\u0435 \u043d\u0435 \u043f\u0440\u043e\u043a\u0430\u0442\u0438\u0442"),questions_count:u.a().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").min(1,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 1 \u0432\u043e\u043f\u0440\u043e\u0441\u0430").max(10,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 10 \u0432\u0435\u043f\u0440\u043e\u0441\u043e\u0432").typeError("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0447\u0438\u0441\u043b\u043e").integer("\u0422\u0430\u043a \u0442\u043e\u0436\u0435 \u043d\u0435 \u043f\u0440\u043e\u043a\u0430\u0442\u0438\u0442")}),onSubmit:function(t,n){(0,n.setSubmitting)(!1),e.setGameParams(Object(l.a)(Object(l.a)({},t),{},{themes:[]}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430"}),Object(r.jsx)(m,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",type:"text"}),Object(r.jsx)(m,{label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0440\u0430\u0443\u043d\u0434\u043e\u0432",name:"rounds_count",type:"text"}),Object(r.jsx)(m,{label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u0442\u0435\u043c\u0435",name:"questions_count",type:"text"}),Object(r.jsx)("button",{type:"submit",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0438\u0433\u0440\u0443"})]})})})},$=function(e){return Object(r.jsx)(o.c,{initialValues:{name:""},validationSchema:u.b({name:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").max(20,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 20 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432")}),onSubmit:function(t,n){(0,n.setSubmitting)(!1),e.setTheme(t)},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u041d\u043e\u0432\u0430\u044f \u0442\u0435\u043c\u0430"}),Object(r.jsx)(m,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",type:"text"}),Object(r.jsx)("button",{type:"submit",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0435\u043c\u0443"})]})})},ee=function(e){return Object(r.jsx)("td",{className:"question-cell ".concat(e.isSet?"":"empty"),onClick:function(){return e.setQuestion(e.round,e.theme,e.value)},children:e.value})},te=function(e){return console.log("theme_q",e.questions),console.log("theme_q_filter100",0!==e.questions.filter((function(t){return t.value===100*e.round})).length),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"theme-name",children:e.name},e.name),[100,200,300,400,500,600,700,800,900,1e3].slice(0,e.questions_count).map((function(t){return Object(r.jsx)(ee,{round:e.round,theme:e.name,value:t*e.round,setQuestion:e.setQuestion,isSet:0!==e.questions.filter((function(n){return n.value===t*e.round})).length},e.name+t)}))]})},ne=function(e){return Object(r.jsx)(o.c,{initialValues:e.initialValues,validationSchema:u.b({text:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").max(200,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 200 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),answer:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").max(50,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 50 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432")}),onSubmit:function(t,n){(0,n.setSubmitting)(!1),e.setQuestion(t)},children:Object(r.jsxs)(o.b,{children:[Object(r.jsxs)("header",{children:[e.theme," \u0437\u0430 ",e.value]}),Object(r.jsx)(m,{label:"\u0422\u0435\u043a\u0441\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u0430",name:"text",type:"text"}),Object(r.jsx)(m,{label:"\u041e\u0442\u0432\u0435\u0442",name:"answer",type:"text"}),Object(r.jsx)("button",{type:"submit",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})})},re=function(e){var t;return console.log(e.initialValues),Object(r.jsx)(o.c,{initialValues:null!==(t=e.initialValues)&&void 0!==t?t:{text:"",answer:""},validationSchema:u.b({text:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").max(200,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 200 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),answer:u.c().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435").max(50,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 50 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432")}),onSubmit:function(t,n){var r=n.setSubmitting,s=n.setErrors;e.setFinalQuestion(t),!function(){for(var t=1;t<e.rounds_count;t++)if(!e.themes[t]||0===e.themes[t].length)return!1;return!0}()?s({submitError:"\u0412 \u043a\u0430\u0436\u0434\u043e\u043c \u0440\u0430\u0443\u043d\u0434\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0442\u0435\u043c\u044b"}):!function(){for(var t=function(t){var n,r=Object(O.a)(e.themes[t]);try{var s=function(){var r=n.value;if(e.questions.filter((function(e){return e.round===t&&e.theme===r.name})).length!==Number(e.questions_count))return{v:{v:!1}}};for(r.s();!(n=r.n()).done;){var a=s();if("object"===typeof a)return a.v}}catch(c){r.e(c)}finally{r.f()}},n=1;n<e.rounds_count;n++){var r=t(n);if("object"===typeof r)return r.v}return!0}()?s({submitError:"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b"}):Y.post(e.game_name,e.themes,e.questions).then((function(t){r(!1),localStorage.removeItem("game"),e.history.push("/games")})).catch((function(e){return s({submitError:e.message})}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441"}),Object(r.jsx)(m,{label:"\u0422\u0435\u043a\u0441\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u0430",name:"text",type:"text"}),Object(r.jsx)(m,{label:"\u041e\u0442\u0432\u0435\u0442",name:"answer",type:"text"}),Object(r.jsx)(b,{name:"submitError"}),Object(r.jsx)("button",{type:"submit",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0433\u0440\u0443"})]})})},se=function(e){var t=Object(h.g)(),n=Object(s.useState)(!1),a=Object(j.a)(n,2),c=a[0],i=a[1],o=Object(s.useState)(!1),u=Object(j.a)(o,2),d=u[0],m=u[1],b=Object(s.useState)(!1),O=Object(j.a)(b,2),f=O[0],x=O[1],_=Object(s.useState)(e.gameParams),p=Object(j.a)(_,2),v=p[0],g=p[1],y=Object(s.useState)(e.gameParams.themes),w=Object(j.a)(y,2),N=w[0],S=w[1],q=Object(s.useState)(1),k=Object(j.a)(q,2),E=k[0],I=k[1],T=Object(s.useState)([]),D=Object(j.a)(T,2),A=D[0],R=D[1],U=Object(s.useState)({index:-1}),C=Object(j.a)(U,2),F=C[0],L=C[1];return Object(s.useEffect)((function(){console.log(e.savedGame),e.savedGame&&(i(e.savedGame.modals.isAddThemeFormOpen),m(e.savedGame.modals.isAddQuestionFormOpen),x(e.savedGame.modals.isAddFinalQuestionFormOpen),g(e.savedGame.gameParams),S(e.savedGame.themes),I(e.savedGame.currentRound),R(e.savedGame.questions),L(e.savedGame.questionParams))}),[]),Object(s.useEffect)((function(){var e={modals:{isAddThemeFormOpen:c,isAddQuestionFormOpen:d,isAddFinalQuestionFormOpen:f},gameParams:v,themes:N,currentRound:E,questions:A,questionParams:F};localStorage.setItem("game",JSON.stringify(e))}),[c,d,f,v,N,E,A,F]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("header",{children:[X(E)," \u0440\u0430\u0443\u043d\u0434"]}),Object(r.jsx)("table",{className:"round add-game-table",children:Object(r.jsx)("tbody",{children:N[E]&&N[E].map((function(e){return Object(r.jsx)(te,{name:e.name,round:E,questions_count:v.questions_count,questions:A.filter((function(t){return t.round===E&&t.theme===e.name})),setQuestion:function(e,t,n){L({round:e,theme:t,value:n,index:A.findIndex((function(r){return r.round===e&&r.theme===t&&r.value===n}))}),m(!0)}},e.name)}))})}),Object(r.jsx)("div",{className:"button-group",children:Object(r.jsx)("button",{onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u0435\u043c\u0443"})}),Object(r.jsxs)("div",{className:"button-group",children:[Object(r.jsx)("button",{disabled:1===E,onClick:function(){return I("final"===E?Number(v.rounds_count)-1:E-1)},children:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0440\u0430\u0443\u043d\u0434"}),Object(r.jsx)("button",{onClick:function(){var e=E+1;console.log("nr",e,v.rounds_count),e===Number(v.rounds_count)?x(!0):I(e)},children:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0440\u0430\u0443\u043d\u0434"})]}),Object(r.jsx)(G.a,{className:"modal form add-theme",overlayClassName:"overlay",isOpen:c,onRequestClose:function(){return i(!1)},ariaHideApp:!1,children:Object(r.jsx)($,{setTheme:function(e){N[E]||(N[E]=[]),N[E].push(e),i(!1),S(N)}})}),Object(r.jsx)(G.a,{className:"modal form add-question",overlayClassName:"overlay",isOpen:d,onRequestClose:function(){return m(!1)},ariaHideApp:!1,children:Object(r.jsx)(ne,{theme:F.theme,value:F.value,setQuestion:function(e){-1===F.index?A.push({round:F.round,theme:F.theme,value:F.value,text:e.text,answer:e.answer}):(A[F.index].text=e.text,A[F.index].answer=e.answer),R(A),m(!1)},initialValues:-1===F.index?{text:"",answer:""}:{text:A[F.index].text,answer:A[F.index].answer}})}),Object(r.jsx)(G.a,{className:"modal form add-final-question",overlayClassName:"overlay",isOpen:f,onRequestClose:function(){return x(!1)},ariaHideApp:!1,children:Object(r.jsx)(re,{game_name:v.name,rounds_count:v.rounds_count,questions_count:v.questions_count,questions:A,themes:N,initialValues:A.filter((function(e){return"final"===e.theme}))[0],history:t,setFinalQuestion:function(e){var t=A.findIndex((function(e){return"final"===e.theme})),n=Object(l.a)({theme:"final",value:200*v.rounds_count*v.questions_count},e);-1===t?A.push(n):A[t]=n,R(A)}})})]})},ae=function(){var e=Object(s.useState)(void 0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(void 0),i=Object(j.a)(c,2),o=i[0],u=i[1];return Object(s.useEffect)((function(){document.title="\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0433\u0440\u044b",u(JSON.parse(localStorage.getItem("game")))}),[]),Object(r.jsx)("div",{className:"add-game",children:n||o?Object(r.jsx)(se,{gameParams:o?o.gameParams:n,savedGame:o}):Object(r.jsx)(Z,{setGameParams:a})})},ce=new S,ie=function(){var e=I(),t=Object(s.useState)({nickname:"",password:""}),n=Object(j.a)(t,2),a=n[0],c=n[1];return document.title="\u041f\u0440\u043e\u0444\u0438\u043b\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",Object(s.useEffect)((function(){ce.get(e.getUsername()).then((function(e){return c({username:e.data.username,nickname:e.data.nickname,password:""})}))}),[e]),Object(r.jsx)("div",{className:"form",children:Object(r.jsx)(o.c,{enableReinitialize:!0,initialValues:a,validationSchema:u.b({nickname:u.c().optional().min(2,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 2 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").max(25,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 25 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),password:u.c().optional().min(6,"\u041d\u0435 \u043c\u0435\u043d\u0435\u0435 6 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").max(128,"\u041d\u0435 \u0431\u043e\u043b\u0435\u0435 128 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432")}),onSubmit:function(e,t){var n=t.setSubmitting,r=t.setErrors;0===e.nickname.length&&0===e.password.length?r({submitError:"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u043e \u043f\u043e\u043b\u0435"}):ce.save(a.username,e.nickname,e.password).then((function(){return n(!1)}))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)("header",{children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),Object(r.jsx)(m,{label:"\u041d\u0438\u043a",name:"nickname",type:"text"}),Object(r.jsx)(m,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password"}),Object(r.jsx)(b,{name:"submitError"}),Object(r.jsx)("button",{type:"submit",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})})})},oe=n(36),ue=n.n(oe),le=n(62),je=(n(242),n(37)),de=n(104),me=new q,be=function(e){return Object(r.jsxs)("div",{className:"player-controls",children:[Object(r.jsx)(o.c,{initialValues:{answer:""},onSubmit:function(t,n){var r,s=n.setSubmitting,a=n.resetForm;(null===(r=t.answer)||void 0===r?void 0:r.length)>0&&(me.submit_answer(e.id,t.answer),a(),s(!1))},children:Object(r.jsxs)(o.b,{children:[Object(r.jsx)(o.a,{id:"answer",as:"textarea",name:"answer",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043e\u0442\u0432\u0435\u0442"}),Object(r.jsx)("button",{type:"submit",children:"\u041e\u0442\u0432\u0435\u0442\u0438\u0442\u044c"})]})}),Object(r.jsx)("button",{onClick:function(){me.leave(e.id),localStorage.removeItem("gameSession"),localStorage.removeItem("game_session_id"),e.history.push("/games")},children:"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0438\u0433\u0440\u044b"})]})},he=function(e){var t,n="";switch(e.state){case K.WAITING:n="\u043e\u0436\u0438\u0434\u0430\u0435\u043c \u0438\u0433\u0440\u043e\u043a\u043e\u0432",t=me.get_host_image_url(K.WAITING);break;case K.ROUND_ENDED:case K.FINAL_ROUND_STARTED:case K.CHOOSING_QUESTION:case K.TIMEOUT:var s;e.state===K.TIMEOUT?n="\u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442: ".concat(e.current_answer.text,". "):(null===(s=e.current_answer)||void 0===s?void 0:s.is_correct)&&(n="\u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e! "),e.state===K.ROUND_ENDED?(n+="\u0420\u0430\u0443\u043d\u0434 \u0437\u0430\u043a\u043e\u043d\u0447\u0435\u043d.",t=me.get_host_image_url(K.ROUND_STARTED)):e.state===K.FINAL_ROUND_STARTED?(n+="\u0412\u043f\u0435\u0440\u0435\u0434\u0438 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0443\u043d\u0434.",t=me.get_host_image_url(K.ROUND_STARTED)):(n+="".concat(e.current_player.nickname,", \u0432\u044b\u0431\u0438\u0440\u0430\u0439\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441."),t=me.get_host_image_url(K.CHOOSING_QUESTION));break;case K.ANSWERING:var a=e.current_question.theme_order,c=e.themes[a].name,i=e.current_question.value;n="".concat(c," \u0437\u0430 ").concat(i),t=me.get_host_image_url(K.ANSWERING),e.current_answer.text.length>0&&(n="\u041d\u0435\u0432\u0435\u0440\u043d\u043e.",t=me.get_host_image_url("wrong"));break;case K.FINAL_ROUND:t=me.get_host_image_url(K.FINAL_ROUND),n="\u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0443\u043d\u0434";break;case K.END_GAME:var o=e.players.reduce((function(e,t){return e.score>t.score?e:t}));n="\u041f\u043e\u0431\u0435\u0434\u0438\u043b ".concat(o.nickname,"!"),t=me.get_host_image_url(K.END_GAME);break;default:n="",t=me.get_host_image_url(K.WAITING)}return Object(r.jsxs)("div",{className:"host-card",children:[Object(r.jsx)("img",{src:t,alt:"host"}),Object(r.jsx)("div",{children:n})]})},Oe=function(e){return console.log(e.text),Object(r.jsx)("div",{className:"question",children:e.text})},fe=function(e){var t=Object(s.useState)(!1),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(r.jsx)("td",{className:"question-cell ".concat(e.is_answered?"empty":""," ").concat(a?"clicked":""),onClick:function(){c(!0),e.questionChosen(e.theme_order,e.question_order)},children:e.value})},xe=function(e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:e.name}),e.questions.map((function(t,n){return Object(r.jsx)(fe,{value:t.value,is_answered:t.is_answered,theme_order:e.theme_order,question_order:n,questionChosen:e.questionChosen},t.value)}))]})},_e=function(e){return Object(r.jsx)("table",{className:"round round-table",children:Object(r.jsx)("tbody",{children:e.themes.map((function(t,n){return Object(r.jsx)(xe,{name:t.name,questions:t.questions,theme_order:n,questionChosen:e.questionChosen},t.name)}))})})},pe=function(e){return Object(r.jsx)(de.a,{className:"game-screen",transitionName:"game-screen",transitionEnterTimeout:1e3,transitionLeaveTimeout:1e3,children:[K.CHOOSING_QUESTION,K.TIMEOUT].includes(e.state)?Object(r.jsx)(_e,{themes:e.round.themes,questionChosen:function(t,n){me.choose_question(e.id,t,n)}},"table"):Object(r.jsx)(Oe,{text:[K.ROUND_STARTED,K.FINAL_ROUND_STARTED].includes(e.state)?e.round_text:e.question_text},"question")})},ve=function(e){var t,n=Object(s.useState)(""),a=Object(j.a)(n,2),c=a[0],i=a[1];function o(){return u.apply(this,arguments)}function u(){return(u=Object(le.a)(ue.a.mark((function e(){return ue.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout((function(){return je.a.hide(t)}),3e3)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){var n,r;e.current_answer.text.length>0&&(null===(n=e.current_answer)||void 0===n||null===(r=n.player)||void 0===r?void 0:r.nickname)===e.nickname&&(i(e.current_answer.text),je.a.show(t),o())}),[e.current_answer]),Object(s.useEffect)((function(){i(e.answer),je.a.show(t),o()}),[e.answer]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"player-card","data-tip":!0,"data-for":e.nickname+"_tooltip",ref:function(e){return t=e},children:[Object(r.jsx)("img",{src:e.avatarURL,alt:e.nickname}),Object(r.jsx)("div",{children:e.nickname}),Object(r.jsx)("div",{children:e.score})]}),Object(r.jsx)(je.a,{className:"tooltip",id:e.nickname+"_tooltip",effect:"solid",delayHide:3e3,event:"null",getContent:function(){return c}})]})},ge=function(e){return Object(r.jsx)("div",{className:"players",children:e.players.length>0&&e.players.map((function(t){return Object(r.jsx)(ve,{nickname:t.nickname,score:t.score,is_playing:t.is_playing,current_answer:e.current_answer,answer:t.answer,avatarURL:me.get_avatar_url()},t.nickname)}))})};function ye(e){var t,n=0,r=Object(O.a)(e.themes);try{for(r.s();!(t=r.n()).done;){n+=t.value.questions.filter((function(e){return e.is_answered})).length}}catch(a){r.e(a)}finally{r.f()}var s=e.themes.length*e.themes[0].questions.length-n;return console.log(s),console.log(e.themes.length),console.log(e.themes[0].questions.length),console.log(n),s}function we(e,t){var n=Object(j.a)(t,2),r=n[0],s=n[1];switch(console.log("r",r),r){case"init":return Object(l.a)(Object(l.a)(Object(l.a)({},e),s),{},{is_initialized:!0,state:K.WAITING});case"set":return Object(l.a)({},s);case"set_state":return Object(l.a)(Object(l.a)({},e),{},{state:s});case"clear_current_answer":return Object(l.a)(Object(l.a)({},e),{},{current_answer:{text:"",player:{nickname:""}}});case"player_joined":var a=e.players.findIndex((function(e){return e.nickname===s.nickname}));return-1===a?Object(l.a)(Object(l.a)({},e),{},{players:e.players.concat(s),current_players:e.current_players+1}):Object(l.a)(Object(l.a)({},e),{},{players:e.players.slice(0,a).concat(s,e.players.slice(a+1))});case"player_left":var c=e.players.findIndex((function(e){return e.nickname===s.nickname}));return e.state===K.WAITING?Object(l.a)(Object(l.a)({},e),{},{players:e.players.slice(0,c).concat(e.players.slice(c+1))}):Object(l.a)(Object(l.a)({},e),{},{players:e.players.slice(0,c).concat(s,e.players.slice(c+1))});case"round_started":return Object(l.a)(Object(l.a)({},e),{},{round:s,round_text:X(s.order+1)+" \u0440\u0430\u0443\u043d\u0434",state:s.order>0?K.ROUND_ENDED:K.ROUND_STARTED});case"final_round_started":return Object(l.a)(Object(l.a)({},e),{},{current_question:s,round_text:"\u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0443\u043d\u0434",state:K.FINAL_ROUND_STARTED});case"current_player_chosen":return Object(l.a)(Object(l.a)({},e),{},{current_player:s});case"current_question_chosen":return Object(l.a)(Object(l.a)({},e),{},{current_question:s,current_answer:{text:"",player:{nickname:""}},state:K.ANSWERING});case"player_answered":var i=e.current_question.theme_order,o=e.current_question.question_order,u=e.players.findIndex((function(e){return e.nickname===s.player.nickname}));return s.is_correct?Object(l.a)(Object(l.a)({},e),{},{current_answer:s,current_player:s.player,state:1===ye(e.round)?e.state:K.CHOOSING_QUESTION,round:Object(l.a)(Object(l.a)({},e.round),{},{themes:e.round.themes.slice(0,i).concat(Object(l.a)(Object(l.a)({},e.round.themes[i]),{},{questions:e.round.themes[i].questions.slice(0,o).concat(Object(l.a)(Object(l.a)({},e.round.themes[i].questions[o]),{},{is_answered:!0}),e.round.themes[i].questions.slice(o+1))}),e.round.themes.slice(i+1))}),players:e.players.slice(0,u).concat(s.player,e.players.slice(u+1))}):Object(l.a)(Object(l.a)({},e),{},{current_answer:s,players:e.players.slice(0,u).concat(s.player,e.players.slice(u+1))});case"question_timeout":var d=e.current_question.theme_order,m=e.current_question.question_order;return Object(l.a)(Object(l.a)({},e),{},{current_answer:s,state:K.TIMEOUT,round:Object(l.a)(Object(l.a)({},e.round),{},{themes:e.round.themes.slice(0,d).concat(Object(l.a)(Object(l.a)({},e.round.themes[d]),{},{questions:e.round.themes[d].questions.slice(0,m).concat(Object(l.a)(Object(l.a)({},e.round.themes[d].questions[m]),{},{is_answered:!0}),e.round.themes[d].questions.slice(m+1))}),e.round.themes.slice(d+1))})});case"final_round_timeout":return Object(l.a)(Object(l.a)({},e),{},{players:s.players,state:K.END_GAME});default:throw new Error("\u043d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f")}}var Ne=function(){var e=Object(h.g)(),t=Object(h.h)(),n=Object(s.useReducer)(we,{id:-1,current_question:{text:""},current_answer:{text:"",player:{nickname:""}},players:[],round:{order:-1,themes:[]}}),a=Object(j.a)(n,2),c=a[0],i=a[1];return Object(s.useEffect)((function(){var e,n;document.title="\u0418\u0433\u0440\u0430";var r=null!==(e=null===(n=t.state)||void 0===n?void 0:n.id)&&void 0!==e?e:localStorage.getItem("game_session_id"),s=new W("game",r);s.setListener(i),localStorage.setItem("game_session_id",r);var a=JSON.parse(localStorage.getItem("gameSession"));return console.log("stor",a),(null===a||void 0===a?void 0:a.is_initialized)?i(["set",a]):(console.log("init",t.state),i(["init",t.state])),function(){return s.close()}}),[]),Object(s.useEffect)((function(){localStorage.setItem("gameSession",JSON.stringify(c))}),[c]),Object(s.useEffect)((function(){function e(e){return t.apply(this,arguments)}function t(){return(t=Object(le.a)(ue.a.mark((function e(t){return ue.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("st",t),e.next=3,new Promise((function(e){return setTimeout((function(){return i(["set_state",t])}),3e3)}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.state===K.ROUND_ENDED?e(K.ROUND_STARTED):c.state===K.ROUND_STARTED?(i(["clear_current_answer",null]),e(K.CHOOSING_QUESTION)):c.state===K.FINAL_ROUND_STARTED&&e(K.FINAL_ROUND)}),[c.state]),Object(r.jsxs)("div",{className:"game",children:[console.log("gsr",c),Object(r.jsx)(pe,{state:c.state,round:c.round,id:c.id,question_text:c.current_question.text,round_text:c.round_text}),Object(r.jsx)(ge,{players:c.players,current_answer:c.current_answer}),Object(r.jsx)(he,{state:c.state,current_player:c.current_player,current_question:c.current_question,current_answer:c.current_answer,themes:c.round.themes,players:c.players}),Object(r.jsx)(be,{id:c.id,history:e})]})};var Se=function(){var e=I();return Object(r.jsx)(A.a,{children:Object(r.jsxs)(h.d,{children:[Object(r.jsx)(h.b,{exact:!0,path:"/",children:e.isAuthenticated?Object(r.jsx)(h.a,{to:"/games"}):Object(r.jsx)(h.a,{to:"/login"})}),Object(r.jsx)(h.b,{path:"/register",children:Object(r.jsx)(R,{})}),Object(r.jsx)(h.b,{path:"/login",children:Object(r.jsx)(U,{})}),Object(r.jsxs)(s.Fragment,{children:[Object(r.jsx)(H,{}),Object(r.jsx)(D,{exact:!0,path:"/user",children:Object(r.jsx)(ie,{})}),Object(r.jsx)(D,{exact:!0,path:"/games",children:Object(r.jsx)(V,{})}),Object(r.jsx)(D,{exact:!0,path:"/games/new",children:Object(r.jsx)(ae,{})}),Object(r.jsx)(D,{path:"/lobby",children:Object(r.jsx)(B,{})}),Object(r.jsx)(D,{path:"/game",children:Object(r.jsx)(Ne,{})})]})]})})},qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,245)).then((function(t){var n=t.getCLS,r=t.getFID,s=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),s(e),a(e),c(e)}))};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(T,{children:Object(r.jsx)(Se,{})})}),document.getElementById("root")),qe()},94:function(e,t,n){},98:function(e,t,n){}},[[243,1,2]]]);
//# sourceMappingURL=main.4979cf1f.chunk.js.map